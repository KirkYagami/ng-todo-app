<div class="add-todo" [formGroup]="form">

  <div class="input-row">
    <input
      class="todo-input"
      [class.todo-input--error]="titleCtrl.invalid && titleCtrl.touched"
      type="text"
      placeholder="What needs to be done? (Enter to add)"
      formControlName="title"
      autocomplete="off"
      autofocus
      (keydown)="onKeydown($event)"
    />
    <button class="options-btn" type="button" (click)="toggleOptions()"
            [class.options-btn--active]="showOptions" title="Options" aria-label="Toggle options">
      âš™
    </button>
    <button class="add-btn" type="button" (click)="onAddClick()">+ Add</button>
  </div>

  @if (titleCtrl.invalid && titleCtrl.touched) {
    <p class="field-error">
      @if (titleCtrl.errors?.['required'])  { Please enter a title. }
      @else if (titleCtrl.errors?.['minlength']) { At least 2 characters required. }
    </p>
  }

  @if (showOptions) {
    <div class="options-panel">

      <!-- Description -->
      <div class="opt-group">
        <label class="opt-label" for="add-desc">Description (optional)</label>
        <textarea id="add-desc" class="desc-input" formControlName="description"
                  placeholder="Add details..." rows="2"></textarea>
      </div>

      <!-- Priority -->
      <div class="opt-group">
        <span class="opt-label">Priority</span>
        <div class="priority-row">
          @for (p of priorities; track p) {
            <label class="priority-chip"
              [class.priority-chip--active]="priorityCtrl.value === p"
              [class.priority-chip--low]="p === 'low'"
              [class.priority-chip--medium]="p === 'medium'"
              [class.priority-chip--high]="p === 'high'">
              <input type="radio" class="sr-only" [value]="p" formControlName="priority" />
              {{ p }}
            </label>
          }
        </div>
      </div>

      <!-- Due Date -->
      <div class="opt-group">
        <label class="opt-label" for="add-due">Due date (optional)</label>
        <input id="add-due" type="date" class="date-input" formControlName="dueDate" />
      </div>

    </div>
  }

</div>